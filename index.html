<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Dieta Pronta ‚Äì Single File</title>
<style>
:root{
  --bg:#0b0f14; --card:#10161d; --ink:#e7eef5; --muted:#9fb1c2;
  --ok:#10B981; --warn:#F59E0B; --err:#EF4444; --ring:#1f2a37;
  --br:14px;
}
*{box-sizing:border-box} html,body{margin:0;background:var(--bg);color:var(--ink);font:16px/1.55 Inter,system-ui,Segoe UI,Roboto,Arial}
.appbar{position:sticky;top:0;z-index:10;background:#0b0f14ee;border-bottom:1px solid #0f1720;padding:14px 16px}
.appbar h1{margin:0;font-size:18px}
.container{max-width:960px;margin:14px auto;padding:0 14px}
.card{background:var(--card);border:1px solid var(--ring);border-radius:var(--br);padding:12px}
.grid{display:grid;gap:12px}
label span{display:block;font-size:12px;color:var(--muted);margin-bottom:4px}
input,select{width:100%;background:#0f141a;color:var(--ink);border:1px solid #182232;border-radius:10px;padding:10px}
.row{display:grid;gap:10px;grid-template-columns:repeat(2,minmax(0,1fr))}
.row3{display:grid;gap:10px;grid-template-columns:repeat(3,minmax(0,1fr))}
.btn{display:inline-block;background:#1b2a3a;color:#dfe8f2;border:1px solid #223243;border-radius:10px;padding:10px 14px;cursor:pointer}
.btn.primary{background:var(--ok);color:#062016;border-color:#0c8f6d;font-weight:700}
.meta{color:var(--muted);font-size:14px}
.totals{display:grid;grid-template-columns:repeat(4,1fr);gap:8px}
.totals .box{background:#0f141a;border:1px solid #19232e;border-radius:10px;padding:10px;display:flex;flex-direction:column}
.totals .box strong{font-size:12px;color:var(--muted)}
.totals .box span{font-size:18px}
.meals{display:grid;gap:12px}
.meal{background:var(--card);border:1px solid var(--ring);border-radius:var(--br);padding:12px}
.meal header{display:flex;align-items:center;justify-content:space-between}
.meal .kcal{color:var(--ok);font-weight:600}
.meal ul{list-style:none;margin:8px 0 4px;padding:0;display:grid;gap:6px}
.meal li{display:flex;justify-content:space-between;align-items:center;background:#0f141a;border:1px solid #182232;border-radius:10px;padding:8px 10px}
.meal .macros{display:flex;gap:10px;color:var(--muted);font-size:14px}
small.disclaimer{display:block;color:var(--muted);text-align:center;margin:22px 0}
footer{border-top:1px solid #0f1720;padding:18px 14px;text-align:center;color:var(--muted)}
@media (max-width:640px){ .row3{grid-template-columns:1fr 1fr}; .totals{grid-template-columns:1fr 1fr} }
</style>
</head>
<body>
  <header class="appbar">
    <h1>Dieta Pronta (2 arquivos)</h1>
  </header>

  <main class="container grid">
    <!-- FORMUL√ÅRIO R√ÅPIDO -->
    <section class="card">
      <h2 style="margin:4px 0 10px;">Question√°rio r√°pido</h2>
      <div class="row3" id="form">
        <label><span>Sexo</span>
          <select id="sex"><option value="male">Masculino</option><option value="female">Feminino</option></select>
        </label>
        <label><span>Idade</span><input id="age" type="number" min="14" value="30"/></label>
        <label><span>Altura (cm)</span><input id="height" type="number" min="120" value="175"/></label>
        <label><span>Peso (kg)</span><input id="weight" type="number" min="35" step="0.1" value="75"/></label>
        <label><span>Atividade</span>
          <select id="activity">
            <option value="sedentary">Sedent√°rio</option>
            <option value="light">Leve</option>
            <option value="moderate" selected>Moderado</option>
            <option value="high">Alta</option>
            <option value="athlete">Atleta</option>
          </select>
        </label>
        <label><span>Objetivo</span>
          <select id="goal">
            <option value="cut">Emagrecer</option>
            <option value="maintain" selected>Manter</option>
            <option value="bulk">Ganhar Massa</option>
          </select>
        </label>
      </div>
      <div style="margin-top:10px;display:flex;gap:8px;align-items:center">
        <button id="gen" class="btn primary">Gerar plano</button>
        <span id="meta" class="meta"></span>
      </div>
    </section>

    <!-- RESUMO -->
    <section class="card">
      <h2 style="margin:4px 0 10px;">Resumo do Dia 1</h2>
      <div id="totals" class="totals"></div>
    </section>

    <!-- REFEI√á√ïES -->
    <section class="card">
      <h2 style="margin:4px 0 10px;">Refei√ß√µes</h2>
      <div id="meals" class="meals"></div>
    </section>

    <small class="disclaimer">Este plano √© educativo e n√£o substitui avalia√ß√£o profissional.</small>
  </main>

  <footer>Feito com üíö ‚Äì Single-file para GitHub Pages</footer>

<script>
// ======= UTIL =======
const round = (n,d=0)=>Number(Math.round((+n+Number.EPSILON)*10**d)/10**d);
const clamp = (v,mi,ma)=>Math.min(Math.max(+v,mi),ma);
const safe = (v,f=0)=>isFinite(+v)?+v:f;

// ======= C√ÅLCULOS =======
const ACTIVITY = {
  sedentary:1.2, light:1.375, moderate:1.55, high:1.725, athlete:1.9
};
const DEFAULT_MACROS = {
  cut:{p:0.35,c:0.40,f:0.25},
  maintain:{p:0.30,c:0.45,f:0.25},
  bulk:{p:0.28,c:0.50,f:0.22}
};
function bmi(weightKg, heightCm){ const h = safe(heightCm)/100; return h?round(safe(weightKg)/(h*h),1):0; }
function bfDeurenberg(bmiV, age, sex){ const s = sex==="male"?1:0; return clamp(round(1.2*bmiV + 0.23*age - 10.8*s - 5.4,1),3,60); }
function bmrMifflin({sex, weightKg, heightCm, age}){ const s = sex==="male"?5:-161; return round(10*weightKg + 6.25*heightCm - 5*age + s); }
function tdee(bmr, activity){ return round(bmr*(ACTIVITY[activity]??1.55)); }
function goalDelta(goal){ return goal==="cut"?-0.15:goal==="bulk"?0.08:0; }
function targetKcal(tdeeValue, goal){ return clamp(round(tdeeValue*(1+goalDelta(goal))),900,6000); }
function macroSplit(goal){ return DEFAULT_MACROS[goal]||DEFAULT_MACROS.maintain; }
function macrosGrams(kcal, split){
  return {
    proteinG: round((kcal*split.p)/4,0),
    carbsG:   round((kcal*split.c)/4,0),
    fatG:     round((kcal*split.f)/9,0),
    kcalTarget: round(kcal)
  };
}
function proteinMinKg(goal){
  if(goal==="cut") return 1.6; if(goal==="bulk") return 2.0; return 1.2;
}
function enforceProtein(weightKg, macros, goal){
  const min = round(weightKg*proteinMinKg(goal),0);
  if(macros.proteinG>=min) return macros;
  const delta = min - macros.proteinG;
  let c = Math.max(0, macros.carbsG - delta);
  let f = Math.max(0, macros.fatG - Math.max(0, delta - (macros.carbsG - c)));
  return { kcalTarget: macros.kcalTarget, proteinG:min, carbsG:c, fatG:f };
}
function compute({sex, age, heightCm, weightKg, activity, goal}){
  const bmiV = bmi(weightKg, heightCm);
  const bf = bfDeurenberg(bmiV, age, sex); // r√°pido
  const bmr = bmrMifflin({sex, weightKg, heightCm, age});
  const tdeeV = tdee(bmr, activity);
  const kcal = targetKcal(tdeeV, goal);
  let m = macrosGrams(kcal, macroSplit(goal));
  m = enforceProtein(weightKg, m, goal);
  return { bmiV, bf, bmr, tdeeV, kcal, macros:m, meta:{goal,activity} };
}

// ======= CAT√ÅLOGO =======
async function loadCatalog(){
  try{
    const r = await fetch("./meals.json", {cache:"no-store"});
    if(!r.ok) throw 0;
    return await r.json();
  }catch{
    // fallback m√≠nimo
    return {
      protein:[
        {"name":"Peito de frango grelhado","kcalPer100":165,"p":31,"c":0,"f":3,"unit":"g"},
        {"name":"Ovo cozido","kcalPer100":155,"p":13,"c":1.1,"f":11,"unit":"g"},
        {"name":"Tofu firme","kcalPer100":76,"p":8,"c":1.9,"f":4.8,"unit":"g"}
      ],
      carbs:[
        {"name":"Arroz branco cozido","kcalPer100":130,"p":2.4,"c":28,"f":0.3,"unit":"g"},
        {"name":"Batata-doce cozida","kcalPer100":90,"p":2,"c":21,"f":0.1,"unit":"g"},
        {"name":"Aveia em flocos","kcalPer100":389,"p":17,"c":66,"f":7,"unit":"g"}
      ],
      fat:[
        {"name":"Azeite de oliva","kcalPer100":884,"p":0,"c":0,"f":100,"unit":"ml"},
        {"name":"Abacate","kcalPer100":160,"p":2,"c":9,"f":15,"unit":"g"},
        {"name":"Castanha de caju","kcalPer100":553,"p":18,"c":30,"f":44,"unit":"g"}
      ],
      mixed:[
        {"name":"Iogurte natural","kcalPer100":61,"p":3.5,"c":4.7,"f":3.3,"unit":"g"},
        {"name":"Feij√£o cozido","kcalPer100":76,"p":5.1,"c":14,"f":0.5,"unit":"g"},
        {"name":"P√£o franc√™s","kcalPer100":270,"p":8,"c":57,"f":3,"unit":"g"}
      ]
    };
  }
}

// ======= PLANEJAMENTO (Dia 1 com 4 refei√ß√µes) =======
const MEALS = [
  {key:"breakfast", label:"Caf√© da manh√£", pct:0.25},
  {key:"lunch",     label:"Almo√ßo",        pct:0.35},
  {key:"snack",     label:"Lanche",        pct:0.15},
  {key:"dinner",    label:"Jantar",        pct:0.25}
];

function pick(arr){ return arr[Math.floor(Math.random()*arr.length)]; }
function portionFromKcal(food, kcalPart){
  const grams = clamp((kcalPart/(food.kcalPer100||100))*100, 10, 400);
  const p = round((grams/100)*(food.p||0));
  const c = round((grams/100)*(food.c||0));
  const f = round((grams/100)*(food.f||0));
  const kcal = round((grams/100)*(food.kcalPer100||100));
  return { grams:round(grams), p, c, f, kcal, unit: food.unit || "g" };
}
function composeMeal(catalog, mealKcal){
  const prot = pick(catalog.protein);
  const carb = pick(catalog.carbs);
  const fat  = pick(catalog.fat);
  const p1 = portionFromKcal(prot, mealKcal*0.50);
  const p2 = portionFromKcal(carb, mealKcal*0.35);
  const p3 = portionFromKcal(fat,  mealKcal*0.15);
  return {
    kcal: p1.kcal+p2.kcal+p3.kcal,
    proteinG: p1.p+p2.p+p3.p,
    carbsG:   p1.c+p2.c+p3.c,
    fatG:     p1.f+p2.f+p3.f,
    items: [
      {name: prot.name, grams:p1.grams, unit:p1.unit},
      {name: carb.name, grams:p2.grams, unit:p2.unit},
      {name: fat.name,  grams:p3.grams, unit:p3.unit}
    ]
  };
}
function fmtTotals(plan){
  const acc = plan.reduce((a,m)=>({kcal:a.kcal+m.kcal,p:a.p+m.proteinG,c:a.c+m.carbsG,f:a.f+m.fatG}),{kcal:0,p:0,c:0,f:0});
  return {kcal:round(acc.kcal), proteinG:round(acc.p), carbsG:round(acc.c), fatG:round(acc.f)};
}

// ======= RENDER =======
function renderTotals(t){
  document.getElementById("totals").innerHTML = `
    <div class="box"><strong>kcal</strong><span>${t.kcal}</span></div>
    <div class="box"><strong>Prote√≠na</strong><span>${t.proteinG} g</span></div>
    <div class="box"><strong>Carbo</strong><span>${t.carbsG} g</span></div>
    <div class="box"><strong>Gordura</strong><span>${t.fatG} g</span></div>
  `;
}
function renderMeals(meals){
  document.getElementById("meals").innerHTML = meals.map((m,i)=>`
    <article class="meal">
      <header><h3>${MEALS[i].label}</h3><span class="kcal">${m.kcal} kcal</span></header>
      <ul>
        ${m.items.map(it=>`<li><span>${it.name}</span><span>${it.grams}${it.unit}</span></li>`).join("")}
      </ul>
      <div class="macros">
        <span>P: ${m.proteinG} g</span><span>C: ${m.carbsG} g</span><span>G: ${m.fatG} g</span>
      </div>
    </article>
  `).join("");
}

// ======= A√á√ÉO =======
document.getElementById("gen").addEventListener("click", async ()=>{
  const sex = document.getElementById("sex").value;
  const age = +document.getElementById("age").value;
  const heightCm = +document.getElementById("height").value;
  const weightKg = +document.getElementById("weight").value;
  const activity = document.getElementById("activity").value;
  const goal = document.getElementById("goal").value;

  const nums = compute({sex, age, heightCm, weightKg, activity, goal});
  document.getElementById("meta").textContent =
    `Meta: ${nums.kcal} kcal ‚Ä¢ Prot ${nums.macros.proteinG}g ‚Ä¢ Carb ${nums.macros.carbsG}g ‚Ä¢ Gord ${nums.macros.fatG}g`;

  const catalog = await loadCatalog();
  const meals = MEALS.map(m=>{
    const mealKcal = round(nums.kcal * m.pct);
    const card = composeMeal(catalog, mealKcal);
    return {...card};
  });

  renderTotals(fmtTotals(meals));
  renderMeals(meals);
});

// Gera um plano inicial na abertura (opcional):
document.getElementById("gen").click();
</script>
</body>
</html>
